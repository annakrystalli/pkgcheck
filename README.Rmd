# pkgreport

<!-- badges: start -->
[![R build status](https://github.com/ropenscilabs/pkgreport/workflows/R-CMD-check/badge.svg)](https://github.com/ropenscilabs/pkgreport/actions?query=workflow%3AR-CMD-check)
[![gitlab push](https://github.com/ropenscilabs/pkgreport/workflows/push-to-gitlab/badge.svg)](https://github.com/ropenscilabs/pkgreport/actions?query=workflow%3Apush-to-gitlab)
[![Project Status: Concept](https://www.repostatus.org/badges/latest/concept.svg)](https://www.repostatus.org/#concept)
<!-- badges: end -->

Report on whether a package is ready for submission to peer review with
[rOpenSci](https://ropensci.org). The report generates a number of statistics 
via the [`pkgstats`](https://github.com/ropenscilabs/pkgstats) package which is
not on CRAN and must first be installed with
```{r pkgapi, eval = FALSE}
remotes::install_github("ropenscilabs/pkgstats")
```
That package also requires both [`ctags`](https://ctags.io) and [GNU
`global`](https://www.gnu.org/software/global/) to be installed. See package
description and those links for how to install those libraries on your system.

Once `pkgstats` has been successfully installed, the `pkgreport` package can
then be loaded via a `library` call:

```{r load, echo = FALSE, message = FALSE}
devtools::load_all(".", export_all = FALSE)
```
```{r load-fakey, eval = FALSE}
library(pkgreport)
```

This package also uses the [github GraphQL
API](https://developer.github.com/v4) which requires a local github token to be
stored with an unambiguous name including `GITHUB` and maybe `QL`, if
alternative `GITHIB` tokens already exist. This can be obtained from github
(via your user settings), and stored using
```{r ghtok, eval = FALSE}
Sys.setenv("GITHUB_QL" = "<my_token>")
```
This can also be set permanently by putting this line in your `~/.Renviron`
file (or creating this if it does not yet exist).

The package also works by locally caching reports previously analysed packages, in
a `pkgreport` subdirectory of the location determined by
```{r, rappdirs, eval = FALSE}
rappdirs::user_cache_dir()
```
You may manually erase the contents of this subdirectory at any time at no
risk. The location may also be over-ridden by setting an environmental variable
named `pkgreport_cache_dir`.


## Usage

The package primarily has one function, `pkgreport`, which accepts the single
argument, `path`, specifying the local location of a git repository to be
analysed. The following code generates a reproducible report by first
downloading a local clone of a repository called
[`srr-demo`](https://github.com/mpadge/srr-demo), which contains the skeleton
of an [`srr` (Software Review Roclets)
package](https://github.com/ropenscilabs/srr), generated with the
[`srr_stats_pkg_skeleton()`
function](https://ropenscilabs.github.io/srr/reference/srr_stats_pkg_skeleton.html):

```{r pkgreport, echo = TRUE, message = FALSE}
library (gert)
mydir <- file.path (tempdir (), "srr-demo")
git_clone ("https://github.com/mpadge/srr-demo", path = mydir)
x <- pkgreport (mydir)
```

That object has default `print` and `summary` methods. The latter can be used
to simply check whether a package is ready for submission:

```{r summary}
summary (x)
```

A package may only be submitted when the summary contains all ticks and no
cross symbols. (And these symbols are colour-coded when generated in
a terminal; GitHub markdown only renders them in black-and-white.) The full
details of the object returned from the `pkgreport` function may be seen with
the default `print` method:

```{r print}
print (x)
```
